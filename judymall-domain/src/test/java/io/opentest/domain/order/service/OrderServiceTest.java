/*
 * Copyright 2019. OPENTEST. All rights reserved.
 */

package io.opentest.domain.order.service;

import io.opentest.domain.order.entity.CreditCardPayment;
import io.opentest.domain.order.entity.MobilePhonePayment;
import io.opentest.domain.order.entity.Order;
import io.opentest.domain.order.entity.OrderDetail;
import io.opentest.domain.order.entity.ShippingAddress;
import io.opentest.domain.order.repository.OrderRepository;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;

/**
 * application.yml 파일이라면 경로를 지정하지 않아도 된다.
 * application 모듈에서 import하기 위해서 suffix를 준다.
 */
@SpringBootTest(properties = {"spring.config.location=classpath:/application-domain.yml"})
public class OrderServiceTest {

    @Autowired
    OrderRepository orderRepository;

    @Test
    @DisplayName("결제수단이 신용카드일 경우 결제가 성공함을 테스트")
    public void shouldAcceptCreditCardPaymentWhenOrderHasSpecialOrderDetail() {

        Order order = new Order();
        order.addOrderDetail(new OrderDetail("P-0004", "상품 D", 1000L, 2));
        order.addOrderPayment(new CreditCardPayment(2000L, "1234-123"));
        order.setShippingAddress(new ShippingAddress("12345", "SomeBody"));

        OrderService orderService = new OrderService(orderRepository);
        orderService.placeOrder(order);
    }

    @Test
    @DisplayName("결제수단이 신용카드가 아닐 경우 예외가 발생함을 테스트")
    public void notAllowedOrderPaymentException() {

        Assertions.assertThrows(IllegalArgumentException.class, () -> {

            Order order = new Order();
            order.addOrderDetail(new OrderDetail("P-0004", "상품 D", 1000L, 2));
            order.addOrderPayment(new MobilePhonePayment(2000L, "010-0000-0000"));
            order.setShippingAddress(new ShippingAddress("12345", "SomeBody"));

            OrderService orderService = new OrderService(orderRepository);
            orderService.placeOrder(order);
        });
    }

}
